# 数据分析理解

## 目录

- [概述](#概述)
- [基础概念定义](#基础概念定义)
- [日留存计算方法](#日留存计算方法)
- [周留存计算方法](#周留存计算方法)
- [实际案例分析](#实际案例分析)
- [关键要点总结](#关键要点总结)

---

## 概述

本文档基于《产品留存数据分析》需求文档，详细解析Dapp Retention功能中日留存和周留存的计算逻辑和实现方法。

## 基础概念定义

### 用户筛选规则

#### 新用户定义
- **范围**: 剔除老用户，仅分析新用户
- **老用户标准**: 通过线下沟通确认（合约交互历史或手工清单）
- **用户标识**: 使用taskon的user_id作为统计标识
- **分析起点**: 开始分析的日期由线下制定

#### "使用应用"行为定义
用户完成以下任意一种行为即视为"使用应用"：
1. **访问网站** (依赖项目方接入SDK上报用户访问信息)
2. **访问iframe网站**
3. **发起与客户提供的合约交互**

### 时间基准点
- **Day 0**: 用户首次使用应用的日期
- **Day N**: 首次使用后的第N天
- **自然周**: 从周一(Monday)开始，到周日(Sunday)结束

---

## 日留存计算方法

### 核心公式
```
Day N 留存率 = (在Day N当天活跃的首次用户数) / (Day 0的首次用户总数) × 100%
```

### 具体含义
- **分母**: Day 0那天首次使用产品的用户总数（固定不变）
- **分子**: 这些首次用户中，在Day N这天仍然活跃的用户数量
- **Day 1留存**: 第二天继续使用产品的用户数 / 首次使用产品的用户数

### 计算示例

假设2025-08-01有500个首次用户：

| 日期 | 首次用户数 | Day1活跃用户 | Day2活跃用户 | Day7活跃用户 | Day30活跃用户 |
|------|-----------|-------------|-------------|-------------|--------------|
| 2025-08-01 | 500 | 300 | 250 | 150 | 50 |

**留存率计算**:
- Day 1留存率 = 300/500 = 60%
- Day 2留存率 = 250/500 = 50%  
- Day 7留存率 = 150/500 = 30%
- Day 30留存率 = 50/500 = 10%

### 数据展示范围
- **展示天数**: Day 1~7、Day 14、Day 30
- **原因**: 避免数据过多，选择关键节点

---

## 周留存计算方法

### 核心公式
```
Week N 留存率 = (第N+1个自然周继续使用产品的用户数) / (第1个自然周首次使用产品的用户数) × 100%
```

### 自然周定义
- **起始**: 周一(Monday)
- **结束**: 周日(Sunday)
- **示例**: 2025-07-28(周一) ~ 2025-08-03(周日)

### 计算逻辑
1. **确定首次用户周期**: 统计某个自然周内的首次用户
2. **观察后续周活跃**: 检查这些用户在后续自然周的活跃情况
3. **计算留存比例**: 后续周活跃用户数 / 首次用户总数

### 计算示例

假设2025-07-28~08-03周有500个首次用户：

| 周期 | 首次用户数 | Week1活跃用户 | Week2活跃用户 | Week3活跃用户 | Week4活跃用户 |
|------|-----------|-------------|-------------|-------------|-------------|
| 7/28~8/3 | 500 | 300 | 200 | 150 | 100 |

**留存率计算**:
- Week 1留存率 = 300/500 = 60%
- Week 2留存率 = 200/500 = 40%
- Week 3留存率 = 150/500 = 30%
- Week 4留存率 = 100/500 = 20%

---

## 实际案例分析

### 案例背景
基于文档中的交互明细记录进行计算演示：

| 时间 | 活动类型 | user_id | 备注 |
|------|---------|---------|------|
| 2025-07-20 | 合约交互 | B | 老用户，需剔除 |
| 2025-08-01 | 白标任务系统上线 | - | 系统事件 |
| 2025-08-01 | 访问网站 | A | 首次用户 |
| ~~2025-08-01~~ | ~~访问网站~~ | ~~B~~ | 老用户，已剔除 |
| 2025-08-01 | 访问网站 | C | 首次用户 |
| 2025-08-01 | 访问iframe | C | 同一用户多次行为 |
| 2025-08-02 | 合约交互 | C | Day1活跃 |
| 2025-08-04 | 访问iframe | A | Day3活跃 |

### 日留存计算
**2025-08-01的Day1留存**:
- **首次用户**: A和C (2人)
- **Day1检查日期**: 2025-08-02
- **Day1活跃用户**: 只有C (1人)
- **Day1留存率**: 1/2 = 50%

### 周留存计算
**2025-07-28~08-03周的Week1留存**:
- **首次用户**: A和C (2人) 
- **下一自然周**: 2025-08-04~08-10
- **Week1活跃用户**: 只有A (1人，在08-04活跃)
- **Week1留存率**: 1/2 = 50%

---

## 关键要点总结

### 1. 计算原则
- **分母固定**: 始终以首次用户总数为分母
- **分子变化**: 随着时间推移，活跃用户数逐渐减少
- **时间基准**: 以用户首次使用日期为起点

### 2. 数据展示规则
- **百分比格式**: 向上取整，不保留小数点
- **无数据处理**: 显示"-"
- **视觉效果**: 热力图，数值越高颜色越深
- **排序方式**: 日期倒序（最新在前）

### 3. 统计意义
- **评估粘性**: 衡量新用户对产品的持续使用意愿
- **优化指导**: 识别流失高峰期，指导产品改进
- **效果验证**: 验证任务系统对用户留存的实际影响

### 4. 业务价值
- **剔除干扰**: 通过过滤老用户，准确评估新功能效果
- **精准分析**: 基于真实的用户行为数据进行计算
- **决策支持**: 为产品迭代和运营策略提供数据依据

---

## 备注

本分析基于《产品留存数据分析》需求文档v1.0，如有计算逻辑调整，请及时更新本文档。
